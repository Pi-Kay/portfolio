<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Space Data Sonification - Petra Kühnle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #fafafa;
            color: #1a1a1a;
            line-height: 1.8;
            min-height: 100vh;
            padding: 80px 20px;
        }
        .container {
            max-width: 720px;
            margin: 0 auto;
        }
        header {
            margin-bottom: 80px;
            padding-bottom: 40px;
            border-bottom: 1px solid #e0e0e0;
        }
        h1 {
            font-size: 1.8em;
            font-weight: 300;
            letter-spacing: -0.3px;
            margin-bottom: 16px;
            color: #000;
        }
        .subtitle {
            font-size: 0.95em;
            color: #666;
            font-weight: 300;
            letter-spacing: 0.3px;
            line-height: 1.6;
        }
        section {
            margin-bottom: 60px;
        }
        h2 {
            font-size: 0.85em;
            font-weight: 400;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 1px solid #f0f0f0;
        }
        p {
            font-size: 0.95em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 300;
        }
        ul {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }
        li {
            font-size: 0.9em;
            color: #444;
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
            font-weight: 300;
            line-height: 1.6;
        }
        li:before {
            content: "—";
            position: absolute;
            left: 0;
            color: #ccc;
        }
        .canvas-container {
            width: 100%;
            max-width: 600px;
            margin: 40px auto;
            border: 1px solid #e0e0e0;
            background: #000;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }
        .canvas-container:hover {
            opacity: 0.95;
            border-color: #999;
        }
        .canvas-container:focus {
            outline: none;
            border-color: #666;
        }
        .canvas-container:focus-visible {
            outline: 3px solid #333;
            outline-offset: 3px;
        }
        .interaction-hint {
            font-size: 0.9em;
            color: #666;
            text-align: center;
            margin: 16px 0 8px;
            font-weight: 400;
            font-style: italic;
        }
        canvas {
            display: block;
            width: 100%;
            height: auto;
        }
        .canvas-caption {
            font-size: 0.85em;
            color: #888;
            text-align: left;
            margin-top: 12px;
            font-weight: 300;
        }
        .data-viz {
            width: 100%;
            max-width: 600px;
            margin: 30px auto;
            padding: 20px;
            background: #fff;
            border: 1px solid #e0e0e0;
        }
        .sketch {
            max-width: 180px;
            height: auto;
            margin: 10px 20px 10px 0;
            display: inline-block;
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        .sketch:hover {
            opacity: 1;
        }
        .visual-container-small {
            position: relative;
            width: 100%;
            max-width: 300px;
            aspect-ratio: 1;
            margin: 30px auto;
            background: #000;
            cursor: pointer;
            transition: opacity 0.3s ease;
            border: 1px solid #e0e0e0;
        }
        .visual-container-small:hover {
            opacity: 0.95;
        }
        .circle-small {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 72%;
            height: 72%;
            background: #d4d4d4;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .visual-container-small:hover .circle-small {
            width: 74%;
            height: 74%;
        }
        .visual-container-small.active .circle-small {
            background: #e8e8e8;
        }
        .midi-chart {
            width: 100%;
            max-width: 600px;
            margin: 30px auto;
            display: block;
        }
        nav {
            margin-top: 80px;
            padding-top: 40px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        nav a {
            color: #666;
            text-decoration: none;
            font-size: 0.85em;
            font-weight: 300;
            letter-spacing: 0.5px;
            transition: color 0.2s;
        }
        nav a:hover {
            color: #000;
        }
        @media (max-width: 768px) {
            body {
                padding: 60px 20px;
            }
            h1 {
                font-size: 1.6em;
            }
            header {
                margin-bottom: 60px;
            }
            section {
                margin-bottom: 50px;
            }
            nav {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .container {
            animation: fadeIn 1s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Open Space Data Sonification</h1>
            <p class="subtitle">Translating between space, visual and sounds</p>
        </header>

        <section>
            <h2>Moon Crater Visualization and Sonification</h2>
            <div class="canvas-container" id="moonCanvasContainer" role="button" tabindex="0" aria-label="Interactive moon visualization - click to start sonification" aria-pressed="false">
                <canvas id="moonCanvas" width="600" height="600" aria-hidden="true"></canvas>
            </div>
            <p class="interaction-hint">Click the moon to start the sonification</p>
            <p class="canvas-caption">Interactive visualization with sonified crater impacts. Each falling star represents a crater from the dataset, sized by diameter. Larger craters produce deeper, longer tones; smaller craters create higher, shorter sounds.</p>
        </section>
        
        <section>
            <h2>Guiding Question</h2>
            <p>How can sonification enhance perception of scientific data and phenomena?</p>
        </section>

        <section>
            <h2>Context</h2>
            <p>Independent exploration of science-art intersection, inspired by Matt Russo's sonification methodology and NASA's open crater datasets.</p>
            <p><strong>Date:</strong> January 2026</p>
            <p><strong>Tools:</strong> Python (Jupyter Notebook), numpy, pandas, matplotlib, midiutil, Logic Pro, AI (Grok, Claude)</p>
            <p><strong>Resources:</strong> Matt Russo methodology, NASA datasets, open-source moon imagery</p>
            <p><strong>Creative approach:</strong> Balancing scientific accuracy (NASA coordinates, measurements) with poetic interpretation (musical mapping, contemplative pacing).</p>
        </section>

        <section>
            <h2>Approach</h2>
            <ul>
                <li>Methodology inspired by Matt Russo's sonification work</li>
                <li>Hybrid workflow: Python/Jupyter for data processing and MIDI generation; Logic Pro for cinematic composition; AI (Claude, Grok) for web visualization code</li>
                <li>Two output modes: Audio-only (Logic Pro instruments, cinematic) and Audio+Visual (real-time Web Audio synthesis, contemplative)</li>
                <li>Parameter mapping: diameter → inverted pitch (larger = deeper tone) + size-based duration</li>
            </ul>
        </section>
        
        <section>
            <h2>Data</h2>
            <p>NASA moon crater dataset: 9 craters selected from ~9,000 catalogued formations.</p>
            <ul>
                <li>Craters: Tycho, Copernicus, Kepler, Aristarchus, Plato, Eratosthenes, Archimedes, Aristoteles, Autolycus</li>
                <li>Measurements: Diameter (32-101 km), depth (1.0-4.7 km), age (108-3800 million years)</li>
                <li>Sonification: Pitch (110-330 Hz), duration (1.5-4.0s), volume (56-100)</li>
            </ul>
            <p><strong>Temporal note:</strong> Animation timing (3-5s between impacts) is artistic compression; actual crater formations span millions of years. Logic Pro composition uses layered soundscape to address temporal gaps in geological record.</p>
            <p><strong>Parameter Mapping:</strong> Diameter → pitch (larger = lower), duration (larger = longer sustain), visual size. Latitude/longitude → impact position. Volume → loudness. Impact moment → visual flash + immediate tone trigger.</p>
        </section>

        <section>
            <h2>Process</h2>
           
            <p><strong>Python workflow:</strong> Data cleaning, parameter mapping, MIDI generation in Jupyter Notebook.</p>
            
            <img src="sketch1.8.png" alt="MIDI note sequencing over time" class="midi-chart">
            <p class="canvas-caption">MIDI temporal structure generated in Python</p>
            
            <p><strong>Logic Pro workflow:</strong> MIDI import, instrument selection (Orchestral Organ, Astro Funk, Studio Grand, Time Delay Synth), mixing, MP3 export.</p>
            
            <p><strong>Web visualization workflow:</strong> JavaScript canvas animation with Web Audio API for real-time synthesis. AI generated code structure; human provided aesthetic direction (open-source moon imagery references), mapping logic (pitch inversion, duration calculations), and audio envelope design (smooth attack/sustain/release).</p>
            
            <p><strong>Workflow insights—AI and human collaboration:</strong></p>
            <ul>
                <li><strong>AI strengths:</strong> Code structure, mathematical conversions (lat/lon to x/y), animation loops, data array implementation</li>
                <li><strong>Human contributions:</strong> Creative decisions (contemplative aesthetic, smooth envelopes), mapping logic (larger = deeper/longer), quality verification</li>
                <li><strong>Critical issue detected by human:</strong> When listening to the animation, tone height differences were not aligned with visible size differences. AI had generated pitch values independently for each crater without maintaining inverse relationship to diameter. Examples: Aristarchus (40km) sounded higher than Kepler (32km); Archimedes (83km) sounded higher than Tycho (85km). Required systematic recalculation using formula: pitch = 330 - ((diameter - 32) / (101 - 32)) × 220</li>
                <li><strong>Corrected mapping:</strong> Kepler 32km→330Hz, Autolycus 39km→310Hz, Aristarchus 40km→304Hz, Eratosthenes 60km→238Hz, Archimedes 83km→154Hz, Tycho 85km→148Hz, Aristoteles 88km→142Hz, Copernicus 93km→135Hz, Plato 101km→110Hz</li>
                <li><strong>Process learning:</strong> Python→MIDI→Logic Pro maintains mathematical consistency (formula applied once). AI-generated JavaScript data requires human verification of cross-entry relationships. Iterative refinement balanced computational efficiency with perceptual accuracy.</li>
            </ul>
        </section>

        <section>
            <h2>Audio Production</h2>
            <p><strong>Logic Pro composition</strong> (OpenSpaceAudio.mp3): Orchestral Organ (deep tones for large craters), Astro Funk (rhythmic elements), Studio Grand (melodic voices), Time Delay Synth (spatial depth). Layered soundscape addresses temporal gaps in geological record.</p>
            
            <div style="text-align: center; margin: 30px 0;">
                <audio id="OpenSpaceAudioPlayer" controls preload="auto" style="width: 100%; max-width: 500px;">
                    <source src="OpenSpaceAudio.mp3" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
                <p class="canvas-caption" style="margin-top: 10px;">Audio-only experience</p>
            </div>
            
            <div class="visual-container-small" id="audioVisualContainer" role="button" tabindex="0" aria-label="Toggle OpenSpace audio with animation" aria-pressed="false">
                <div class="circle-small"></div>
            </div>
            <p class="canvas-caption">Audio with minimal visual feedback</p>
        </section>

        <section>
            <h2>Visual Production</h2>
            <p>Web animation with falling star impacts, crater formation synchronized to data parameters. Human-defined aesthetic: calm, contemplative. References: open-source moon imagery. Iterative AI prompting (Claude, Grok) for code refinement.</p>
            <p><strong>Mapping decisions:</strong> Inverted pitch scale (larger = deeper, matching physical intuition). Duration from crater diameter (larger = longer sustain ~4s, smaller ~2s). Smooth audio envelopes for contemplative atmosphere.</p>
        </section>

        <section>
            <h2>Data Analysis</h2>
            <div class="data-viz">
                <canvas id="scatterAge" width="600" height="400"></canvas>
            </div>
            <p class="canvas-caption">Crater diameter vs age: Larger craters tend to be older, formed during periods of heavy bombardment.</p>
            
            <div class="data-viz">
                <canvas id="scatterTime" width="600" height="400"></canvas>
            </div>
            <p class="canvas-caption">Crater diameter vs time since impact: Distribution shows bombardment patterns over lunar history.</p>
        </section>

        <section>
            <h2>Results</h2>
            <p>Enhanced data accessibility through multisensory representation. Sonification provides alternative access for visually impaired audiences; visuals support those with hearing differences.</p>
            <p><strong>Transferability:</strong> Methodology applicable to other NASA datasets (exoplanet discoveries, seismic activity on Mars) and scientific data from climate research, particle physics, biological systems.</p>
            <p><strong>Workflow discovery:</strong> Process revealed complementary strengths—AI excels at code structure and mathematical operations; human perception catches relationship inconsistencies and guides aesthetic refinement. Effective collaboration requires iterative verification and clear definition of perceptual goals.</p>
        </section>

        <nav>
            <a href="index.html">Back</a>
            <a href="case2.html">Next Case</a>
        </nav>
    </div>

    <audio id="OpenSpaceAudio" loop preload="auto">
        <source src="OpenSpaceAudio.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Crater data from CSV (sample)
        const CRATER_DATA = [
            {name: "Tycho", latitude: -43.31, longitude: -11.36, diameter_km: 85, depth_km: 4.7, age_ma: 108, pitch_hz: 148, volume: 95, time_since_impact_0: 0},
            {name: "Copernicus", latitude: 9.62, longitude: -20.08, diameter_km: 93, depth_km: 3.8, age_ma: 800, pitch_hz: 135, volume: 97, time_since_impact_0: 692},
            {name: "Kepler", latitude: 8.13, longitude: -38.04, diameter_km: 32, depth_km: 2.6, age_ma: 800, pitch_hz: 330, volume: 56, time_since_impact_0: 692},
            {name: "Aristarchus", latitude: 23.73, longitude: -47.40, diameter_km: 40, depth_km: 3.0, age_ma: 450, pitch_hz: 304, volume: 63, time_since_impact_0: 342},
            {name: "Plato", latitude: 51.62, longitude: -9.33, diameter_km: 101, depth_km: 1.0, age_ma: 3500, pitch_hz: 110, volume: 100, time_since_impact_0: 3392},
            {name: "Eratosthenes", latitude: 14.47, longitude: -11.29, diameter_km: 60, depth_km: 3.6, age_ma: 3200, pitch_hz: 238, volume: 77, time_since_impact_0: 3092},
            {name: "Archimedes", latitude: 29.72, longitude: -4.00, diameter_km: 83, depth_km: 2.1, age_ma: 3600, pitch_hz: 154, volume: 91, time_since_impact_0: 3492},
            {name: "Aristoteles", latitude: 50.17, longitude: 17.42, diameter_km: 88, depth_km: 3.3, age_ma: 3800, pitch_hz: 142, volume: 94, time_since_impact_0: 3692},
            {name: "Autolycus", latitude: 30.70, longitude: 1.48, diameter_km: 39, depth_km: 3.4, age_ma: 3200, pitch_hz: 310, volume: 62, time_since_impact_0: 3092}
        ];

        let canvas, ctx;
        let soundEnabled = false;
        let audioContext;
        let fallingStars = [];
        let craters = [];
        let scheduleInterval;
        let craterIndex = 0;

        // OpenSpace Audio variables
        const openSpaceAudio = document.getElementById('OpenSpaceAudio');
        const openSpaceAudioPlayer = document.getElementById('OpenSpaceAudioPlayer');
        const audioVisualContainer = document.getElementById('audioVisualContainer');
        let isAudioPlaying = false;
        openSpaceAudio.volume = 0.35;
        openSpaceAudioPlayer.volume = 0.35;

        // Sync the two audio elements
        openSpaceAudioPlayer.addEventListener('play', function() {
            if (!isAudioPlaying) {
                openSpaceAudio.currentTime = openSpaceAudioPlayer.currentTime;
                openSpaceAudio.play();
                isAudioPlaying = true;
                audioVisualContainer.classList.add('active');
                audioVisualContainer.setAttribute('aria-pressed', 'true');
            }
        });

        openSpaceAudioPlayer.addEventListener('pause', function() {
            openSpaceAudio.pause();
            isAudioPlaying = false;
            audioVisualContainer.classList.remove('active');
            audioVisualContainer.setAttribute('aria-pressed', 'false');
        });

        function initCanvas() {
            canvas = document.getElementById('moonCanvas');
            ctx = canvas.getContext('2d');
            drawMoon();
            animate();
            drawScatterPlots();
        }

        function drawMoon() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(canvas.width, canvas.height) * 0.35;

            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const gradient = ctx.createRadialGradient(
                centerX - radius * 0.3, centerY - radius * 0.3, radius * 0.1,
                centerX, centerY, radius
            );
            gradient.addColorStop(0, '#e8e8e8');
            gradient.addColorStop(0.7, '#c0c0c0');
            gradient.addColorStop(1, '#888');

            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.fill();

            craters.forEach(crater => {
                drawCrater(crater.x, crater.y, crater.size, crater.age);
            });
        }

        function drawCrater(x, y, size, age) {
            const opacity = Math.max(0.1, 1 - (age / 100));
            
            ctx.strokeStyle = `rgba(80, 80, 80, ${opacity * 0.6})`;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.stroke();

            ctx.fillStyle = `rgba(50, 50, 50, ${opacity * 0.3})`;
            ctx.beginPath();
            ctx.arc(x + size * 0.2, y + size * 0.2, size * 0.8, 0, Math.PI * 2);
            ctx.fill();
        }

        function createFallingStarWithData(craterData) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(canvas.width, canvas.height) * 0.35;
            
            const latRad = craterData.latitude * Math.PI / 180;
            const lonRad = craterData.longitude * Math.PI / 180;
            
            const targetX = centerX + radius * Math.cos(latRad) * Math.sin(lonRad);
            const targetY = centerY - radius * Math.sin(latRad);
            
            const craterSize = Math.min(30, (craterData.diameter_km / 100) * 25);
            
            const speed = 2 + Math.random() * 2;
            
            // Duration based on crater size: larger craters = longer duration
            const sizeDuration = 1.5 + (craterData.diameter_km / 100) * 2.5; // 1.5-4s range
            
            return {
                x: Math.random() * canvas.width,
                y: -50,
                targetX: targetX,
                targetY: targetY,
                speed: speed,
                size: 2 + Math.random() * 2,
                craterSize: craterSize,
                freq: craterData.pitch_hz,
                dur: sizeDuration,
                volume: craterData.volume / 100,
                name: craterData.name
            };
        }

        function drawFallingStar(star) {
            const gradient = ctx.createRadialGradient(star.x, star.y, 0, star.x, star.y, star.size * 3);
            gradient.addColorStop(0, 'rgba(255, 255, 200, 1)');
            gradient.addColorStop(0.5, 'rgba(255, 200, 150, 0.5)');
            gradient.addColorStop(1, 'rgba(255, 150, 100, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(star.x, star.y, star.size * 3, 0, Math.PI * 2);
            ctx.fill();

            ctx.strokeStyle = 'rgba(255, 200, 150, 0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(star.x, star.y);
            ctx.lineTo(star.x - (star.targetX - star.x) * 0.1, star.y - (star.targetY - star.y) * 0.1);
            ctx.stroke();
        }

        function animate() {
            requestAnimationFrame(animate);
            drawMoon();

            fallingStars.forEach((star, index) => {
                drawFallingStar(star);

                const dx = star.targetX - star.x;
                const dy = star.targetY - star.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < star.speed) {
                    craters.push({
                        x: star.targetX,
                        y: star.targetY,
                        size: star.craterSize,
                        age: 0
                    });
                    
                    // Play main impact tone
                    playImpactTone(star.freq, star.dur, star.volume, star.speed);
                    
                    // Play subtle bright flash tone at moment of impact
                    playImpactFlash();
                    
                    // Visual flash
                    ctx.fillStyle = 'rgba(255, 255, 200, 0.3)';
                    ctx.beginPath();
                    ctx.arc(star.targetX, star.targetY, star.craterSize * 3, 0, Math.PI * 2);
                    ctx.fill();

                    fallingStars.splice(index, 1);
                } else {
                    star.x += (dx / dist) * star.speed;
                    star.y += (dy / dist) * star.speed;
                }
            });

            craters.forEach(crater => crater.age++);
            if (craters.length > 20) {
                craters.shift();
            }
        }

        function playImpactTone(freq, dur, volume, speed) {
            if (!audioContext) return;

            const now = audioContext.currentTime;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            // Subtle timbre variation - mostly sine with slight triangle blend
            if (speed > 3.2) {
                osc.type = 'sine';
            } else {
                osc.type = 'sine'; // Keep mostly sine for consistency
            }
            
            osc.frequency.value = freq;
            
            // Very smooth, gradual envelope
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.12 * volume, now + 0.05); // Gentler attack
            gain.gain.linearRampToValueAtTime(0.10 * volume, now + dur * 0.6); // Longer sustain
            gain.gain.exponentialRampToValueAtTime(0.00001, now + dur + 0.2); // Extended smooth fade

            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.start(now);
            osc.stop(now + dur + 0.3);
        }

        function playImpactFlash() {
            if (!audioContext) return;

            const now = audioContext.currentTime;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            osc.type = 'sine';
            osc.frequency.value = 1200; // High, bright tone
            
            // Very short, sharp attack for impact moment
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.08, now + 0.005);
            gain.gain.exponentialRampToValueAtTime(0.00001, now + 0.08);

            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.start(now);
            osc.stop(now + 0.1);
        }

        function createFallingStarWithAudio() {
            if (!soundEnabled) return;

            const craterData = CRATER_DATA[craterIndex % CRATER_DATA.length];
            craterIndex++;
            
            const star = createFallingStarWithData(craterData);
            fallingStars.push(star);
        }

        function drawScatterPlots() {
            drawScatterAge();
            drawScatterTime();
        }

        function drawScatterAge() {
            const canvas = document.getElementById('scatterAge');
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(60, 20);
            ctx.lineTo(60, 360);
            ctx.lineTo(580, 360);
            ctx.stroke();
            
            ctx.fillStyle = '#000';
            ctx.font = '14px Arial';
            ctx.fillText('age [Myrs]', 280, 390);
            ctx.save();
            ctx.translate(20, 200);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('diameter [km]', -50, 0);
            ctx.restore();
            
            ctx.fillStyle = '#1f77b4';
            CRATER_DATA.forEach(d => {
                const x = 60 + (d.age_ma / 4000) * 520;
                const y = 360 - (d.diameter_km / 300) * 340;
                const size = Math.max(5, d.diameter_km / 10);
                
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawScatterTime() {
            const canvas = document.getElementById('scatterTime');
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(60, 20);
            ctx.lineTo(60, 360);
            ctx.lineTo(580, 360);
            ctx.stroke();
            
            ctx.fillStyle = '#000';
            ctx.font = '14px Arial';
            ctx.fillText('time since impact 0 [Myrs]', 220, 390);
            ctx.save();
            ctx.translate(20, 200);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('diameter [km]', -50, 0);
            ctx.restore();
            
            ctx.fillStyle = '#1f77b4';
            CRATER_DATA.forEach(d => {
                const x = 60 + (d.time_since_impact_0 / 4000) * 520;
                const y = 360 - (d.diameter_km / 300) * 340;
                const size = Math.max(5, d.diameter_km / 10);
                
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function startSonification() {
            soundEnabled = true;
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }

            createFallingStarWithAudio();
            
            scheduleInterval = setInterval(() => {
                if (soundEnabled) {
                    createFallingStarWithAudio();
                }
            }, 3000 + Math.random() * 2000);
        }

        function stopSonification() {
            soundEnabled = false;
            if (scheduleInterval) {
                clearInterval(scheduleInterval);
            }
        }

        function toggleOpenSpaceAudio() {
            if (!isAudioPlaying) {
                const playPromise = openSpaceAudio.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        isAudioPlaying = true;
                        audioVisualContainer.classList.add('active');
                        audioVisualContainer.setAttribute('aria-pressed', 'true');
                        openSpaceAudioPlayer.currentTime = openSpaceAudio.currentTime;
                        openSpaceAudioPlayer.play();
                    }).catch(err => {
                        console.error('Audio playback failed:', err);
                    });
                }
            } else {
                openSpaceAudio.pause();
                openSpaceAudioPlayer.pause();
                isAudioPlaying = false;
                audioVisualContainer.classList.remove('active');
                audioVisualContainer.setAttribute('aria-pressed', 'false');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            initCanvas();

            const moonCanvasContainer = document.getElementById('moonCanvasContainer');
            
            moonCanvasContainer.addEventListener('click', function() {
                if (!soundEnabled) {
                    startSonification();
                    moonCanvasContainer.setAttribute('aria-pressed', 'true');
                } else {
                    stopSonification();
                    moonCanvasContainer.setAttribute('aria-pressed', 'false');
                }
            });

            moonCanvasContainer.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    moonCanvasContainer.click();
                }
            });

            audioVisualContainer.addEventListener('click', toggleOpenSpaceAudio);
            audioVisualContainer.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggleOpenSpaceAudio();
                }
            });
        });
    </script>
</body>
</html>
