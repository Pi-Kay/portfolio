<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - Petra K.</title>
    <link rel="stylesheet" href="styles.css?v=13">
    <style>
        /* Sonification controls styling */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            color: #555;
            padding: 10px 20px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 400;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            font-family: 'Inter', sans-serif;
        }
        .sound-toggle:hover,
        .sound-toggle:focus {
            background: #fff;
            border-color: #bbb;
            color: #222;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
            outline: 2px solid rgba(11, 61, 145, 0.2);
            outline-offset: 2px;
        }
        .sound-toggle:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }
        .sound-toggle.off {
            background: #f5f5f5;
            border-color: #ddd;
            color: #888;
        }
        .sound-toggle.off:hover,
        .sound-toggle.off:focus {
            background: #fff;
            border-color: #bbb;
            color: #555;
        }
        .sound-icon {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        @media (max-width: 640px) {
            .sound-toggle {
                bottom: 16px;
                right: 16px;
                padding: 12px 20px;
                font-size: 14px;
            }
        }
        a:focus,
        button:focus {
            outline: 2px solid rgba(11, 61, 145, 0.2);
            outline-offset: 2px;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="sr-only">Skip to main content</a>
    <header>
        <h1>Petra K.</h1>
        <p>Interface Design, Hybrid AI Design and Hybrid Sonification Projects</p>
    </header>
    <main id="main-content">
        <section class="cover">
            <figure>
                <canvas id="bannerCanvas" width="800" height="400" aria-label="Hybrid sonification banner visualizing ambient sounds in a moon theme."></canvas>
                <p><strong></strong></p>
                <br>
            </figure>
            <nav aria-label="Case studies">
                <ul>
                    <li><a href="case1.html">Music AI Compliance Doc</a></li>
                    <li><a href="case2.html">Open Space Data Sonification</a></li>
                    <li><a href="case3.html">Health Hackathon Prototyping</a></li>
                </ul>
                <br>
            </nav>
        </section>
    </main>
    <footer>
        <p>&copy; 2026 Petra K. All rights reserved.</p>
    </footer>
    <button id="soundToggle"
            class="sound-toggle off"
            aria-pressed="false"
            aria-label="Toggle ambient sound sonification">
        <svg class="sound-icon"
             viewBox="0 0 24 24"
             fill="none"
             stroke="currentColor"
             stroke-width="2"
             aria-hidden="true"
             role="img">
            <title>Sound icon</title>
            <path d="M11 5L6 9H2v6h4l5 4V5z"/>
            <path id="soundWaves" d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
        </svg>
        <span id="soundText" aria-live="polite">Sound Off</span>
    </button>
    <script>
    var audioContext;
var soundEnabled = false;
var scheduleInterval;
var canvas;
var ctx;
var stars = [];
var impacts = [];

function initCanvas() {
    canvas = document.getElementById('bannerCanvas');
    ctx = canvas.getContext('2d');
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    drawBackground();
    animate();
}

function drawBackground() {
    // Scientific space background: Nebula-like gradient with microbiology filaments
    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    gradient.addColorStop(0, '#000010');  // Deep space blue-black
    gradient.addColorStop(0.5, '#0a001a');  // Purple nebula tint
    gradient.addColorStop(1, '#000010');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Faint microbiology-inspired filaments (abstract web-like structures)
    ctx.strokeStyle = 'rgba(200, 200, 255, 0.1)';  // Subtle blue glow
    ctx.lineWidth = 0.5;
    for (let i = 0; i < 20; i++) {
        ctx.beginPath();
        ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
        for (let j = 0; j < 5; j++) {
            ctx.quadraticCurveTo(
                Math.random() * canvas.width,
                Math.random() * canvas.height,
                Math.random() * canvas.width,
                Math.random() * canvas.height
            );
        }
        ctx.stroke();
    }
    
    // Moon as a textured, cratered sphere (more realistic)
    const moonGradient = ctx.createRadialGradient(canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, 150);
    moonGradient.addColorStop(0, '#eee');
    moonGradient.addColorStop(1, '#aaa');
    ctx.fillStyle = moonGradient;
    ctx.beginPath();
    ctx.arc(canvas.width / 2, canvas.height / 2, 150, 0, Math.PI * 2);
    ctx.fill();
    
    // Add subtle craters for scientific realism
    ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
    for (let i = 0; i < 10; i++) {
        const cx = canvas.width / 2 + (Math.random() * 200 - 100);
        const cy = canvas.height / 2 + (Math.random() * 200 - 100);
        const cr = Math.random() * 20 + 5;
        ctx.beginPath();
        ctx.arc(cx, cy, cr, 0, Math.PI * 2);
        ctx.fill();
    }
}

function createStar() {
    return {
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        size: Math.random() * 3 + 2,  // Larger for glow
        alpha: 0,
        fadeIn: true
    };
}

function drawStar(star) {
    // Soft light flare (ethereal glow, like distant light sources or microbes)
    const gradient = ctx.createRadialGradient(star.x, star.y, 0, star.x, star.y, star.size * 3);
    gradient.addColorStop(0, `rgba(255, 255, 220, ${star.alpha})`);  // Soft yellowish core
    gradient.addColorStop(0.3, `rgba(255, 255, 220, ${star.alpha * 0.5})`);  // Diffuse mid
    gradient.addColorStop(1, 'rgba(255, 255, 220, 0)');  // Fade to transparent
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(star.x, star.y, star.size * 3, 0, Math.PI * 2);  // Larger diffuse circle
    ctx.fill();
}

function createImpact(x, y, dur) {
    return {
        x: x,
        y: y,
        arms: 6 + Math.floor(Math.random() * 4),  // 6-10 radiating arms
        length: 0,
        maxLength: dur * 20 + 30,  // Scale max size with audio duration
        alpha: 1,
        curveFactor: Math.random() * 0.5 + 0.2  // For organic curvature
    };
}

function drawImpact(impact) {
    // Abstract fractal burst (slower, with curvature for microbial realism)
    ctx.strokeStyle = `rgba(255, 150, 50, ${impact.alpha})`;  // Orange-red glow
    ctx.lineWidth = 1;
    for (let i = 0; i < impact.arms; i++) {
        const angle = (Math.PI * 2 / impact.arms) * i + Math.random() * 0.1;  // Slight irregularity
        const endX = impact.x + Math.cos(angle) * impact.length;
        const endY = impact.y + Math.sin(angle) * impact.length;
        const cpX = impact.x + Math.cos(angle + impact.curveFactor) * (impact.length / 2);  // Control point for curve
        const cpY = impact.y + Math.sin(angle + impact.curveFactor) * (impact.length / 2);
        
        ctx.beginPath();
        ctx.moveTo(impact.x, impact.y);
        ctx.quadraticCurveTo(cpX, cpY, endX, endY);
        ctx.stroke();
    }
}

function animate() {
    requestAnimationFrame(animate);
    drawBackground(); // Redraw background to clear previous frames
    
    // Draw stars/lights
    stars.forEach((star, index) => {
        drawStar(star);
        
        if (star.fadeIn) {
            star.alpha += 0.02;  // Slower fade-in for ethereal effect
            if (star.alpha >= 0.6) star.fadeIn = false;  // Lower peak for subtlety
        } else {
            star.alpha -= 0.008;  // Slower fade-out
            if (star.alpha <= 0) stars.splice(index, 1);
        }
    });
    
    // Draw impacts
    impacts.forEach((impact, index) => {
        drawImpact(impact);
        
        impact.length += 0.8;  // Slower growth (was 1.5)
        impact.alpha -= 0.005;  // Slower fade (was 0.008)
        if (impact.length > impact.maxLength || impact.alpha <= 0) impacts.splice(index, 1);
    });
}

function initAudio() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    return audioContext;
}

function createAndPlayTone() {
    if (!audioContext || !soundEnabled) return;
    
    try {
        var now = audioContext.currentTime;
        var x = Math.random();
        var y = Math.random();
        var freq = 220 + (1 - y) * 440;
        var dur = 2 + (Math.random() * 1);  // Extract dur for visual sync
        
        var osc1 = audioContext.createOscillator();
        var osc2 = audioContext.createOscillator();
        var osc3 = audioContext.createOscillator();
        
        osc1.type = 'sine';
        osc2.type = 'sine';
        osc3.type = 'sine';
        
        osc1.frequency.value = freq;
        osc2.frequency.value = freq * 2.01;
        osc3.frequency.value = freq * 3.02;
        
        var g1 = audioContext.createGain();
        var g2 = audioContext.createGain();
        var g3 = audioContext.createGain();
        
        g1.gain.setValueAtTime(0, now);
        g1.gain.linearRampToValueAtTime(0.04, now + 0.02);
        g1.gain.exponentialRampToValueAtTime(0.001, now + 2.5);
        
        g2.gain.setValueAtTime(0, now);
        g2.gain.linearRampToValueAtTime(0.02, now + 0.02);
        g2.gain.exponentialRampToValueAtTime(0.001, now + 2.5);
        
        g3.gain.setValueAtTime(0, now);
        g3.gain.linearRampToValueAtTime(0.01, now + 0.02);
        g3.gain.exponentialRampToValueAtTime(0.001, now + 2.5);
        
        var reverb = audioContext.createConvolver();
        var rate = audioContext.sampleRate;
        var length = rate * 2;
        var buffer = audioContext.createBuffer(2, length, rate);
        
        for (var ch = 0; ch < 2; ch++) {
            var data = buffer.getChannelData(ch);
            for (var i = 0; i < length; i++) {
                data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, 2);
            }
        }
        reverb.buffer = buffer;
        
        var reverbGain = audioContext.createGain();
        reverbGain.gain.value = 0.4;
        
        var pan = audioContext.createStereoPanner();
        pan.pan.value = (x * 2) - 1;
        
        var filter = audioContext.createBiquadFilter();
        filter.type = 'lowpass';
        filter.frequency.value = 2000 + (y * 2000);
        
        var master = audioContext.createGain();
        master.gain.value = 0.15;
        
        osc1.connect(g1);
        osc2.connect(g2);
        osc3.connect(g3);
        
        g1.connect(filter);
        g2.connect(filter);
        g3.connect(filter);
        
        filter.connect(master);
        filter.connect(reverbGain);
        reverbGain.connect(reverb);
        reverb.connect(master);
        
        master.connect(pan);
        pan.connect(audioContext.destination);
        
        osc1.start(now);
        osc2.start(now);
        osc3.start(now);
        osc1.stop(now + dur);
        osc2.stop(now + dur);
        osc3.stop(now + dur);
        
        // Add visuals synced to tone
        addVisualEffect(freq, pan.pan.value, dur);
    } catch (e) {
        console.error('Error playing tone:', e);
    }
}

function addVisualEffect(freq, panValue, dur) {
    const delay = (freq > 440) ? 0.1 : 0.3;  // Higher freq: quicker lights; lower: slower impacts
    setTimeout(() => {
        if (freq > 440) {
            // High freq: Ethereal lights (2-4 for subtlety)
            for (let i = 0; i < Math.floor(Math.random() * 3) + 2; i++) {
                stars.push(createStar());
            }
        } else {
            // Low freq: Abstract impact on moon, scaled to dur
            let moonX = canvas.width / 2;
            let moonY = canvas.height / 2;
            let impactX = moonX + (panValue * 100) + (Math.random() * 100 - 50);
            let impactY = moonY + (Math.random() * 100 - 50);
            impacts.push(createImpact(impactX, impactY, dur));
        }
    }, delay * 1000);  // Delay in ms for better audio-visual match
}

function startAmbientSound() {
    soundEnabled = true;
    createAndPlayTone();
    startScheduling();
}

function startScheduling() {
    if (scheduleInterval) {
        clearInterval(scheduleInterval);
    }
    
    scheduleInterval = setInterval(function() {
        if (soundEnabled && audioContext) {
            createAndPlayTone();
        }
    }, 3000 + Math.random() * 3000);
}

function stopAmbientSound() {
    soundEnabled = false;
    if (scheduleInterval) {
        clearInterval(scheduleInterval);
        scheduleInterval = null;
    }
    stars = [];
    impacts = [];
}

function toggleSound() {
    var button = document.getElementById('soundToggle');
    var text = document.getElementById('soundText');
    var waves = document.getElementById('soundWaves');
    
    if (!soundEnabled) {
        initAudio();  // Create context on gesture
        if (audioContext.state === 'suspended') {
            audioContext.resume().then(() => {
                startAmbientSound();
            }).catch((err) => {
                console.error('AudioContext resume failed:', err);
                alert('Sound failed to start. Please try again or check browser permissions.');
            });
        } else {
            startAmbientSound();
        }
        button.classList.remove('off');
        button.setAttribute('aria-pressed', 'true');
        text.textContent = 'Sound On';
        if (waves) waves.style.opacity = '1';
    } else {
        stopAmbientSound();
        button.classList.add('off');
        button.setAttribute('aria-pressed', 'false');
        text.textContent = 'Sound Off';
        if (waves) waves.style.opacity = '0.3';
    }
}

// Initialize canvas on load
window.addEventListener('load', initCanvas);
window.addEventListener('resize', () => {
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    drawBackground();
});

// Event listeners (unchanged)
document.getElementById('soundToggle').addEventListener('touchstart', function(e) {
    e.preventDefault();
    toggleSound();
}, { passive: false });
document.getElementById('soundToggle').addEventListener('click', toggleSound);

document.getElementById('soundToggle').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleSound();
    }
});

var waves = document.getElementById('soundWaves');
if (waves) waves.style.opacity = '0.3';
        </script>
</body>
</html>
